:root{--bg:#0b0d12;--panel:#12151c;--ink:#e5e7eb;--muted:#94a3b8;--border:#1f2633;--accent:#6ea8ff;--accent-2:#22d3ee;--node:#151923;--node-border:#253041;--node-shadow:0 8px 22px rgba(0,0,0,.55);--edge:#7a8aa3}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Helvetica Neue",Arial,sans-serif}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:var(--panel);color:var(--ink);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:2}
.topbar .hint{opacity:.75;margin-left:8px}
.topbar button,.palette-item,#btnLoadExample{background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:6px 10px;cursor:pointer;color:var(--ink);transition:.15s box-shadow,.15s transform}
.topbar button:hover,.palette-item:hover,#btnLoadExample:hover{box-shadow:0 4px 16px rgba(0,0,0,.35)}
.topbar select{border:1px solid var(--border);border-radius:10px;padding:6px 8px;background:var(--panel);color:var(--ink)}
.main{display:flex;height:calc(100vh - 50px)}
.sidebar{width:280px;background:var(--panel);color:var(--ink);border-right:1px solid var(--border);display:flex;flex-direction:column}
.sidebar h3{margin:12px 12px 6px;font-size:13px;text-transform:uppercase;color:var(--muted);letter-spacing:.04em}
.palette{display:flex;flex-wrap:wrap;gap:8px;padding:8px}
.palette-item{border:1px dashed var(--border)}
.props{padding:10px;margin:8px;background:var(--panel);border:1px solid var(--border);border-radius:12px;min-height:120px;box-shadow:0 1px 4px rgba(0,0,0,.4)}
.props.empty{opacity:.75}
.canvas-container{flex:1;position:relative;background:var(--bg)}
.canvas{position:absolute;inset:0;outline:none;background-image:radial-gradient(rgba(255,255,255,.06) 1px, transparent 1px);background-size:18px 18px;z-index:0}
.edges{position:absolute;inset:0;pointer-events:none;filter:drop-shadow(0 0 6px rgba(110,168,255,.25));z-index:1}
.node{position:absolute;min-width:200px;max-width:340px;background:var(--node);color:var(--ink);border:1px solid var(--node-border);border-radius:14px;box-shadow:var(--node-shadow);z-index:2}
.node.pill{border-radius:999px;min-width:260px}
.node.circle{min-width:120px;max-width:140px;border-radius:16px}
.node-header{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:linear-gradient(180deg,#171c27,#121722);border-bottom:1px solid var(--border);border-radius:14px 14px 0 0}
.node-type{font-size:12px;font-weight:700;color:var(--muted)}
.node-delete{background:transparent;border:none;color:var(--muted);font-size:16px;cursor:pointer}
.node-title{padding:12px 14px;font-weight:700}
.ports{display:flex;justify-content:space-between;align-items:center;padding:10px 12px}
.port{width:10px;height:10px;border-radius:6px;border:2px solid rgba(255,255,255,.85);background:#0b1020;box-shadow:0 0 0 3px rgba(110,168,255,.25),0 0 8px rgba(110,168,255,.25)}
.port.in{background:#0b1020;box-shadow:0 0 0 3px rgba(34,211,238,.25),0 0 8px rgba(34,211,238,.25)}
.edge{stroke:var(--edge);stroke-width:2.2;fill:none}
.edge.data{stroke-dasharray:6 4;opacity:.8}
.edge.error{stroke:#ef4444}
.edge.exec-active{stroke:#22d3ee;filter:drop-shadow(0 0 6px rgba(34,211,238,.45))}
.selected{outline:3px solid rgba(110,168,255,.5)}
.invalid{outline:3px solid rgba(239,68,68,.6) !important}
.edge.invalid{stroke:#ef4444 !important; stroke-dasharray:6 4}
.badge{display:inline-block;border-radius:999px;background:#2a0f0f;color:#ffb4b4;padding:2px 8px;font-size:12px}

/* Property panel rows */
.props .row{display:flex;align-items:center;gap:8px;margin:8px 0}
.props .row label{min-width:64px;font-size:12px;color:var(--muted)}
.props .row input{flex:1;border:1px solid var(--border);border-radius:10px;padding:6px 8px;background:#0e1320;color:var(--ink)} 
.node-header .node-icon{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:6px;background:#1f2633;color:#cbd5e1;margin-right:8px;font-size:12px;box-shadow:inset 0 0 0 1px var(--border)}
.node[data-type="Start"] .node-icon{background:#0b3b1e;color:#34d399}
.node[data-type="End"] .node-icon{background:#3a0d0d;color:#f87171}
.node[data-type="Task"] .node-icon{background:#0d2847;color:#6ea8ff}
.node[data-type="If"] .node-icon{background:#41280d;color:#facc15}
.node[data-type="Switch"] .node-icon{background:#0d2f2f;color:#22d3ee}
.node.pill .node-title{white-space:pre-wrap} 
.node-tools{margin-left:auto;display:flex;gap:6px}
.node-tools button{background:transparent;border:1px solid var(--border);border-radius:6px;color:var(--muted);cursor:pointer;padding:2px 6px}
.node-tools button:hover{color:var(--ink);border-color:#2b3547}
.ctx-menu{position:absolute;background:var(--panel);border:1px solid var(--border);border-radius:8px;box-shadow:0 12px 28px rgba(0,0,0,.5);padding:6px;z-index:10}
.ctx-menu hr{border:0;border-top:1px solid var(--border);margin:6px 0}
.ctx-menu button{display:block;width:160px;text-align:left;background:transparent;border:none;color:var(--ink);padding:6px 8px;border-radius:6px;cursor:pointer}
.ctx-menu button:hover{background:#1a2030}

/* New server types */
.node[data-type="Server"] .node-icon{background:#0d1b2a;color:#8ab4f8}
.node[data-type="ServerFarm"] .node-icon{background:#1b2a0d;color:#a3e635}
.node[data-type="ServerSwarm"] .node-icon{background:#2a0d27;color:#f0abfc}

/* Animations */
@keyframes flowDash{to{stroke-dashoffset:-100}}
@keyframes pulseGlow{0%{box-shadow:0 0 0 0 rgba(110,168,255,.45)}70%{box-shadow:0 0 0 10px rgba(110,168,255,0)}100%{box-shadow:0 0 0 0 rgba(110,168,255,0)}}
.edge.flow{stroke-dasharray:8 6;animation:flowDash 1.8s linear infinite}
.node.pulse{animation:pulseGlow 1.8s ease-out infinite}

/* Subtle hover accent on nodes */
.node:hover{transform:translateY(-1px); transition:transform .12s ease}
.node.exec-active{box-shadow:0 0 0 3px rgba(34,211,238,.45), var(--node-shadow)}
.node.exec-done{opacity:.9;border-color:#2b3547}

/* Accessibility */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Focus styles for better keyboard navigation */
.node:focus,
.palette-item:focus,
button:focus,
input:focus,
select:focus {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

.node:focus-visible {
  outline: 3px solid var(--accent);
  outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --bg: #000000;
    --panel: #1a1a1a;
    --ink: #ffffff;
    --border: #666666;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .edge.flow,
  .node.pulse {
    animation: none;
  }
  
  .node:hover {
    transform: none;
    transition: none;
  }
  
  .notification {
    transition: none;
  }
} 